{% extends "finanzas/base.html" %}
{% load static %}
{% block title %}Gesti√≥n de Usuarios{% endblock %}

{% block content %}
<div class="admin-container">
  <h1><i class="fa-solid fa-users-cog"></i> Gesti√≥n de Usuarios</h1>

  <!-- üîπ Mensajes de √©xito/error -->
  {% if messages %}
  <div class="messages">
    {% for message in messages %}
    <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %}">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- üîπ Formulario para crear usuario -->
  <div class="form-card">
    <h3><i class="fa-solid fa-user-plus"></i> Crear nuevo usuario</h3>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary">
        <i class="fa-solid fa-floppy-disk"></i> Crear usuario
      </button>
    </form>
  </div>

  <!-- üîπ Tabla de usuarios -->
  <div class="table-card">
    <h3><i class="fa-solid fa-users"></i> Usuarios existentes</h3>
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Correo</th>
          <th>Rol</th>
          <th>√öltimo login</th>
          <th>Fecha de creaci√≥n</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u.id }}</td>
          <td>{{ u.username }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.is_staff|yesno:"Administrador,Usuario" }}</td>
          <td>{{ u.last_login|default:"-" }}</td>
          <td>{{ u.date_joined|date:"d M Y H:i" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" style="text-align:center;">No hay usuarios registrados</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
.admin-container {
  padding: 20px 40px;
}

.form-card, .table-card {
  background: var(--card-bg, #fff);
  color: var(--text-color, #333);
  border-radius: 12px;
  padding: 20px;
  margin-top: 25px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: background 0.3s, color 0.3s;
}

body.dark-mode .form-card,
body.dark-mode .table-card {
  background: #1f1f1f;
  color: #f2f2f2;
}

.users-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

.users-table th, .users-table td {
  padding: 10px 14px;
  border-bottom: 1px solid #ddd;
}

body.dark-mode .users-table th, 
body.dark-mode .users-table td {
  border-color: #333;
}

.alert {
  padding: 10px 14px;
  border-radius: 8px;
  margin-bottom: 10px;
}

.alert-success { background: #d4edda; color: #155724; }
.alert-danger { background: #f8d7da; color: #721c24; }
.alert-warning { background: #fff3cd; color: #856404; }

body.dark-mode .alert-success { background: #254b32; color: #c7f5d2; }
body.dark-mode .alert-danger { background: #5a1e22; color: #ffbaba; }
body.dark-mode .alert-warning { background: #554b1e; color: #fff6c1; }
</style>
{% endblock %}
